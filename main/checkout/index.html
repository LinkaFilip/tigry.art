<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Platba</title>
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="stylesheet" href="../variables.css">

  <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
  <link rel="shortcut icon" href="/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Tigry.art" />
  <link rel="manifest" href="/favicon/site.webmanifest" />

</head>
<body>
  <style>
    body {
      background: #fafafa;
      color: #333;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
    }

.checkout-wrapper {
  background: #fff;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  max-width: 400px;
  width: 100%;
}

h1 {
  font-size: 1.5rem;
  margin-bottom: 1rem;
  text-align: center;
}

#card-element {
  padding: 1rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-bottom: 1rem;
  background: #fefefe;
}

#pay-button {
  width: 100%;
  padding: 0.75rem;
  background-color: #0077cc;
  color: white;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease;
}

#pay-button:disabled {
  background-color: #aaa;
  cursor: not-allowed;
}

#payment-message {
  margin-top: 1rem;
  font-size: 0.9rem;
  color: #cc0000;
  text-align: center;
}
  </style>
  <div class="checkout-wrapper">
    <h1>Objednávka plakátu – 10 €</h1>
    <div id="card-element"></div>
    <button id="pay-button" disabled>Zaplatit</button>
    <div id="payment-message"></div>
  </div>


  <script>
    // veřejný klíč
    const stripe = Stripe('pk_live_51LpXXlEqK4P4Y8FRmvpDyFPIhKGiJCVCgYE1gMsYK6C7mjzJvFK8PAQlN9coFjtGeKuvVMAMO4iKHePrFRwNrSDM00wFzIJwxA');

    const elements = stripe.elements();
    const card = elements.create('card');
    card.mount('#card-element');

    const payButton = document.getElementById('pay-button');
    const paymentMessage = document.getElementById('payment-message');

    card.on('change', function(event) {
      payButton.disabled = event.empty || !!event.error;
      paymentMessage.textContent = event.error ? event.error.message : '';
    });

    payButton.addEventListener('click', async () => {
      payButton.disabled = true;
      paymentMessage.textContent = 'Probíhá zpracování platby...';

      // Zavoláme backendovou funkci Netlify pro vytvoření PaymentIntent
      const response = await fetch('/.netlify/functions/create-payment-intent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount: 1000 }), // 300 Kč v haléřích
      });

      const data = await response.json();

      if (data.error) {
        paymentMessage.textContent = 'Chyba: ' + data.error;
        payButton.disabled = false;
        return;
      }

      const result = await stripe.confirmCardPayment(data.clientSecret, {
        payment_method: {
          card: card,
          billing_details: { name: 'Zákazník' },
        }
      });

      if (result.error) {
        paymentMessage.textContent = 'Platba selhala: ' + result.error.message;
        payButton.disabled = false;
      } else if (result.paymentIntent.status === 'succeeded') {
        paymentMessage.textContent = 'Platba úspěšná! Děkujeme za objednávku.';
      }
    });
  </script>
</body>
</html>