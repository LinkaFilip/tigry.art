<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Platba</title>
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="stylesheet" href="variables.css">
</head>
<body>
  <h1>Objednávka plakátu - 10 eur</h1>

  <div id="card-element"></div>
  <button id="pay-button" disabled>Zaplatit</button>
  <div id="payment-message"></div>

  <script>
    const stripe = Stripe('pk_live_51LpXXlEqK4P4Y8FRmvpDyFPIhKGiJCVCgYE1gMsYK6C7mjzJvFK8PAQlN9coFjtGeKuvVMAMO4iKHePrFRwNrSDM00wFzIJwxA');

    const elements = stripe.elements();
    const card = elements.create('card');
    card.mount('#card-element');

    const payButton = document.getElementById('pay-button');
    const paymentMessage = document.getElementById('payment-message');

    card.on('change', function(event) {
      payButton.disabled = event.empty || !!event.error;
      paymentMessage.textContent = event.error ? event.error.message : '';
    });

    payButton.addEventListener('click', async () => {
      payButton.disabled = true;
      paymentMessage.textContent = 'Probíhá zpracování platby...';


      const response = await fetch('/.netlify/functions/create-payment-intent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount: 1000 }),
      });

      const data = await response.json();

      if (data.error) {
        paymentMessage.textContent = 'Chyba: ' + data.error;
        payButton.disabled = false;
        return;
      }

      const result = await stripe.confirmCardPayment(data.clientSecret, {
        payment_method: {
          card: card,
          billing_details: { name: 'Zákazník' },
        }
      });

      if (result.error) {
        paymentMessage.textContent = 'Platba selhala: ' + result.error.message;
        payButton.disabled = false;
      } else if (result.paymentIntent.status === 'succeeded') {
        paymentMessage.textContent = 'Platba úspěšná! Děkujeme za objednávku.';
      }
    });
  </script>
</body>
</html>