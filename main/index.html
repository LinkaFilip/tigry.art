<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Platba</title>
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="stylesheet" href="variables.css">
</head>
<body>
  <h1>Objednávka plakátu – 300 Kč</h1>

  <form id="payment-form">
    <div id="card-element"></div>
    <button type="submit">Zaplatit</button>
    <div id="payment-message"></div>
  </form>

  <script>
    const stripe = Stripe("pk_live_51LpXXlEqK4P4Y8FRmvpDyFPIhKGiJCVCgYE1gMsYK6C7mjzJvFK8PAQlN9coFjtGeKuvVMAMO4iKHePrFRwNrSDM00wFzIJwxA");

    fetch("/.netlify/functions/create-payment-intent", { method: "POST" })
      .then(res => res.json())
      .then(data => {
        const elements = stripe.elements();
        const card = elements.create("card");
        card.mount("#card-element");

        document.getElementById("payment-form").addEventListener("submit", async (event) => {
          event.preventDefault();
          const result = await stripe.confirmCardPayment(data.clientSecret, {
            payment_method: {
              card: card
            }
          });

          if (result.error) {
            document.getElementById("payment-message").innerText = "Chyba: " + result.error.message;
          } else {
            if (result.paymentIntent.status === 'succeeded') {
              document.getElementById("payment-message").innerText = "Platba proběhla úspěšně!";
            }
          }
        });
      });
  </script>
</body>
</html>